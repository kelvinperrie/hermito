<html>
<head>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="data/hermit-data.js"></script>
    <style>

    </style>
    <link href="styles/hermit.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri&family=Permanent+Marker&display=swap" rel="stylesheet">
</head>
<body>
    <script>
    </script>

    <!-- bind the page model - can't do this on a template element -->
    <div x-data="pageModel" x-init="console.log('pagemode init')">
        <div class="details-popup-container" x-show="showCompareDialog">
            <div class="popup">
                <div class="popup-banner">
                    Crab details
                    <a href="" title="right-click and copy this link to give to someone else to open this popup" data-bind="attr: { href : popupUrl }">
                        <span class="material-icons popup-link">
                            link
                        </span>
                    </a>
                    <div class="popup-close" @click="toggleCompareDialog()">
                        <span class="material-icons">
                            cancel
                        </span>
                    </div>
                </div>
                <div class="popup-content" >
                    <template x-for="crab in markedCrabs" :key="crab.scientificName">
                        <div class="crab-detail-container">
                            <div data-bind="" class="remove-crab-from-dialog-container"><span @click="crab.toggleMarkForCompare()" data-bind="visible: $parent.crabsForCompare().length > 1, click: function() { toggleForCompare(); }">remove this crab</span></div>
                            <div class="common-name" x-text="crab.commonName"></div>
                            <div class="scientific-name" >(<span x-text="crab.scientificName"></span>)</div>
                            <div class="crab-image-container" data-bind="with : currentImage" title="click for next image">
                                <div class="image-count-display" title="click image to show next picture" data-bind="text: $parent.images.length, visible: $parent.images.length > 1"></div>
                                <img class="crab-image" :src="crab.currentDisplayedImage().url" alt="crab picture" />
                                <span class="material-icons view-image-fullsize-trigger" title="Open image as large as possible" data-bind="click : function() { $parents[1].openImageFullsize($parents[0]); }">
                                    zoom_out_map
                                </span>
                                <div class="previous-image-trigger" @click="crab.navigateImagePrevious()" title="click for previous image">
                                    <span class="material-icons">
                                        keyboard_arrow_left
                                    </span>
                                </div>
                                <div class="next-image-trigger" @click="crab.navigateImageNext()" title="click for next image">
                                    <span class="material-icons">
                                        keyboard_arrow_right
                                    </span>
                                </div>
                            </div>
                            <div class="details-list">
                                Details:
                                <ul>
                                    <template x-for="detail in crab.details" :key="detail.text">
                                        <li>
                                            <span x-text="detail.text"></span>
                                            <sup x-show="detail.references.length > 0">
                                                <template x-for="reference in detail.references" :key="reference">
                                                    <span x-text="reference"></span>
                                                </template>
                                            </sup>
                                        </li>
                                    </template>
                                </ul>
                            </div>
                            <div class="similar-to-list">
                                Simlar crabs:
                                <ul>
                                    <template x-for="similar in crab.similarTo" :key="similar.key">
                                        <li><span x-text="similar.label"></span><span class="details-compare-link" data-bind="click: function() { $parents[1].openForCompareByKey(key) }">compare</span></li>
                                    </template>
                                    <li x-show="crab.similarTo.length === 0">none</li>
                                </ul>
                            </div>
                            <div class="references">
                                <template x-for="reference in crab.references" :key="reference.id">asdfasdfs
                                    <div class="reference"><span x-text="reference.id"></span>: <span x-text="reference.detail"></span></div>
                                </template>
                            </div>
                            <div class="crab-links">
                                <div class="crab-link">
                                    <a data-bind="attr: { href : natureWatchLink }" target="_blank" title="See more info on inaturalist.nz">
                                        <i class="material-icons">info</i>
                                    </a>
                                </div>
                                <div class="crab-link">
                                    <a data-bind="attr: { href : natureWatchImagesLink }" target="_blank" title="See more images on inaturalist.nz">
                                        <i class="material-icons">image</i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>
        Your crabbies are:<br/>
        <div class="crab-tile-container">
            <!-- x-for must be on a template item? keys are important if reordering? -->
            <template x-for="crab in crabs" :key="crab.scientificName">
                <div class="crab-tile">
                    <div class="crab-title">
                        <span x-text="crab.scientificName"></span><br/>
                        <span x-text="crab.commonName"></span>
                    </div>
                    <div class="crab-image-container">
                        <img class="crab-image" alt="hermit crab image" :src="crab.currentDisplayedImage().url" />
                        <div class="next-image-trigger" title="click for next image" @click="crab.navigateImageNext()">
                            <span class="material-icons">
                                keyboard_arrow_right
                            </span>
                        </div>
                        <div class="previous-image-trigger" title="click for previous image" @click="crab.navigateImagePrevious()">
                            <span class="material-icons">
                                keyboard_arrow_left
                            </span>
                        </div>
                    </div>
                    <!-- <span x-text="crab.currentDisplayedImage().url"></span><br/> -->
                    <div class="crab-links">
                        <div class="crab-link">
                            <a target="_blank" title="See more info on inaturalist.nz" :href="crab.inaturalistLink">
                                <i class="material-icons">info</i>
                            </a>
                        </div>
                        <div class="crab-link">
                            <a target="_blank" title="See more images on inaturalist.nz" :href="crab.inaturalistImagesLink">
                                <i class="material-icons">image</i>
                            </a>
                        </div>
                        <div class="crab-links-right">
                            <div class="crab-link" @click="crab.toggleMarkForCompare()" title="select this crab for comparing when you open the crab details popup">
                                <span x-show="crab.markForCompare" class="material-icons">check_box</span>
                                <span x-show="!crab.markForCompare" class="material-icons">check_box_outline_blank</span>
                            </div>
                            <div class="crab-link"  @click="toggleCompareDialog()" title="open the details of this and any other selected crab">
                                <span class="material-icons">zoom_in</span>
                            </div>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </div>
    <script src="scripts/hermit.js"></script>

</body>
</html>